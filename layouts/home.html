{{ define "main" }}
  <article>
    <h1>{{ .Title }}</h1>
    {{ .Content | safeHTML }}
  </article>

  <div class="masonry">
    {{ range shuffle .Site.RegularPages }}
      {{ if in .Params.categories "Sticky Note" }}
        <article class="masonry__item card">
          <section class="card__body">
            {{ $title := .Title }}
            {{ with .Params.image }}
              <img src="{{ . | absURL }}" alt="{{ $title }}" class="card__image">
            {{ end }}
            <h2 class="card__title">
              <span class="emoji">{{ with .Params.emoji }}{{ . }}{{ else }}ğŸ—’ï¸{{ end }}</span>
              <span>{{ .Title }}</span>
            </h2>
            {{ with .Params.description }}
              <p>{{ . }}</p>
            {{ else }}
              <p>{{ .Content | safeHTML }}</p>
            {{ end }}
            <div class="card__meta">
              {{ if .Params.categories }}
                <strong>
                  <span>{{ index .Params.categories 0 | title }}: </span>
                </strong>
              {{ end }}
              {{ partial "components/timeago.html" . }}
            </div>
          </section>
        </article>
      {{ end }}
    {{ end }}
  </div>
  
  {{ $stages := slice "seedling" "sprout" "budding" "lush" "evergreen" }}
  {{ $emojiMap := dict
    "seedling" "ğŸŒ±"
    "sprout" "ğŸŒ¿"
    "budding" "ğŸŒ¼"
    "lush" "ğŸª´"
    "evergreen" "ğŸŒ²"
  }}

  <style>
    #posts-container {
      display: grid;
      gap: 1rem;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      padding: 1rem;
    }

    #stage-select {
      padding: 0.25rem;
      background-color: var(--bg-second);
      color: var(--cl-text-default);
      border-radius: 0.25rem;
      outline: none;
    }

    .stage-label {
      font-weight: bolder;
      font-size: 1.2rem;
    }
  </style>
  <select id="stage-select">
    <option value="all">ğŸŒ All Growth Stages</option>
    {{ range $stages }}
      <option value="{{ . }}">{{ index $emojiMap . }} {{ . | title }}</option>
    {{ end }}
  </select>

  <hr>

  <div id="posts-container">
    {{ range .Site.RegularPages }}
      {{ $stage := .Params.stage }}
      {{ if $stage }}
        <figure class="figure post-card" data-stage="{{ $stage }}" style="box-shadow:var(--shadow-md);border:1px solid var(--cl-border-default); border-radius:8px; padding:1rem; margin-bottom:1rem;">
          {{ with .Params.Image }}
            <img class="figure__image" src="{{ . | relURL }}" alt="{{ .Title }}">
          {{ end }}
          <div class="figure__caption">
            <h3>
              <span class="emoji">{{ index $emojiMap $stage }}</span>
              <a href="{{.Permalink | relURL }}">{{ .Title }}</a>
            </h3>
            <p>{{ .Summary | strings.Truncate 200 }}</p>
          </div>
        </figure>
      {{ end }}
    {{ end }}
  </div>

  <script defer>
    const select = document.getElementById("stage-select");
    const posts = document.querySelectorAll(".post-card");

    select.addEventListener("change", () => {
      const selected = select.value;
      posts.forEach(post => {
        const stage = post.dataset.stage;
        post.style.display = (selected === "all" || stage === selected) ? "block" : "none";
      });
    });
  </script>
{{/*  
  <hr>

  <div class="masonry">
    {{ range shuffle .Site.RegularPages }}
      {{ if not (in .Params.categories "Sticky Note") }}
        <article class="masonry__item card">
          <section class="card__body">
            {{ $title := .Title }}
            {{ with .Params.image }}
              <img src="{{ . | absURL }}" alt="{{ $title }}" class="card__image">
            {{ end }}
            <a href="{{ .RelPermalink }}" class="card__title">
              <span class="emoji">{{ with .Params.emoji }}{{ . }}{{ else }}ğŸ—’ï¸{{ end }}</span>
              <span>{{ .Title }}</span>
            </a>
            {{ with .Params.description }}
              <p>{{ . }}</p>
            {{ else }}
              <p>{{ .Summary | truncate 80 }}</p>
            {{ end }}
            <div class="card__meta">
              {{ if .Params.categories }}
                <strong>
                  <span>{{ index .Params.categories 0 | title }}: </span>
                </strong>
              {{ end }}
              {{ partial "components/timeago.html" . }}
            </div>
          </section>
        </article>
      {{ end }}
    {{ end }}
  </div>  */}}
{{ end }}